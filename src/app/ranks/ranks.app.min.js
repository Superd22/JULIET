var services=services||angular.module("services",[]);services.factory("RankTrans",["$http",function(c,b){var a={};a.loading=true;a.getRanks=function(){var d=c.get("Ranks/getAllRanks.php").then(function(e){return e.data});return d};a.hasAdmin=function(){a.loading=true;var d=c.post("Rights/index.php",{right:"USER_CAN_ADMIN_RANKS"}).then(function(f){var e=false;if(f.data=="1"||f.data=="true"){e=true}a.loading=false;return e});return d};a.getUserName=function(){a.loading=true;var d=c.post("API/get_users_by_id.php",{user:1}).then(function(e){var f=e.data;a.loading=false;return f.replace(/"/g,"")});return d};a.updateRank=function(h,f){var d=f||"mod";var e={mod:d,rank:h};var g=c.post("Ranks/editRank.php",e).then(function(i){return i.data});return g};a.getUserRank=function(){a.loading=true;var d=c.get("Ranks/getUserRank.php").then(function(e){a.loading=false;return e.data});return d};return a}]);var Ranks=angular.module("Ranks",["services","ui.router","FBAngular","dndLists"]);Ranks.controller("controller.ranks",["$scope","$http","$stateParams","RankTrans","$state",function(b,g,e,a,d){var c=-1;var f=null;b.models={rankSelected:0};b.models.displayEdit=false;b.rSelect=0;b.FULL=[false,false,false];b.isMakeFull=false;b.PROUT=[];if(e.wing){b.isMakeFull=true;if(e.wing=="Militaire"){b.FULL[0]=true}if(e.wing=="Consortium"){b.FULL[1]=true}if(e.wing=="Syndicat"){b.FULL[2]=true}}getRanks=function(){var h=a.getRanks();h.then(function(i){b.models.RANKS=i})};getAdmin=function(){var h=a.hasAdmin();h.then(function(i){b.models.HasRights=i})};b.makeFull=function(h){b.FULL=[false,false,false];b.isMakeFull^=true;b.FULL[h]=true};b.addPosInStar=function(j){var i=j.length;var h={id_POS:String(i),ranks:[]};j.push(h)};b.addRankInStar=function(k,j,i){p=k||{id_POS:0};var h={name:"Nouveau Rang",url:"https://starcitizen.fr/Flotte/images/rank/blank.png",ID:c,type:i,pos:p.id_POS,stars:j};k.ranks.push(h);b.models.rankSelected=h;c--};b.updatePosRank=function(h,j,i,k){j.pos=k.id_POS||0;j.stars=i.id_STAR;console.log(j);a.updateRank(j).then(function(l){console.log(l);getRanks()})};b.validateRank=function(h){b.resetSelect();a.updateRank(h).then(function(){if(h.ID<0){getRanks()}})};b.deleteRank=function(h){if(confirm("Êtes vous sur de vouloir définitivement supprimer ce rang ?")){b.resetSelect();a.updateRank(h,"del").then(function(){getRanks()})}};b.resetSelect=function(){b.models.rankSelected=0};b.selEtPoivre=function(h){b.displayEdit=true};b.$watch("models.RANKS",function(h){b.modelAsJson=angular.toJson(h,true)},true);getRanks();getAdmin()}]);Ranks.controller("controller.ranks.user",["$scope","$http","$stateParams","RankTrans","$state",function(d,h,f,c,e){d.test="caca";d.HasRights=false;d.userRank={};d.userName="Name";var a=c.hasAdmin();var b=c.getUserRank();var g=c.getUserName();a.then(function(i){d.HasRights=i});b.then(function(i){d.userRank=i});g.then(function(i){d.userName=i})}]);Ranks.config(["$stateProvider","$urlRouterProvider","$locationProvider",function(c,a,b){c.state("Ranks",{url:"/",views:{"Ranks@":{controller:"controller.ranks",templateUrl:"Ranks/templates/Ranks_main.tmpl.html"},"UserRank@":{controller:"controller.ranks.user",templateUrl:"Ranks/templates/Ranks_user.tmpl.html"}}}).state("Ranks.oneWing",{url:"Aile/:wing",views:{"Ranks@":{controller:"controller.ranks",templateUrl:"Ranks/templates/Ranks_main.tmpl.html"},"UserRank@":{controller:"controller.ranks.user",templateUrl:"Ranks/templates/Ranks_user.tmpl.html"}}});a.otherwise("/")}]);